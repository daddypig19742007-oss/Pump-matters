<!DOCTYPE html> <html> <head> <meta charset="utf-8" /> <title>Pump Analysis Viewer</title> <meta name="viewport" content="width=device-width, initial-scale=1" /> <style> body { font-family: Arial, sans-serif; padding: 16px; max-width: 900px; margin: 0 auto; } label { display: block; margin-top: 8px; } .card { border: 1px solid #ccc; padding: 12px; margin-top: 12px; } </style> </head> <body> <h1>Pump Analysis Viewer</h1> <p>Enter an Equipment ID to load the latest measurement and calculations.</p> <div> <label>Equipment ID <input id="equipId" placeholder="e.g., EQ-001" /> </label> <button id="loadBtn">Load</button> </div> <div id="results" class="card" style="display:none"></div> <script> const G = 9.80665; const ATM_kPa = 101.325; function rhoWater(tempC){ if (tempC <= 20) return 998.2; if (tempC >= 60) return 983.2; return 998.2 - ((tempC - 20) * (998.2 - 983.2) / 40); } function Pv_kPa(tempC){ if (tempC <= 20) return 2.34; if (tempC >= 60) return 19.9; return 2.34 + ((tempC - 20) * (19.9 - 2.34) / 40); } function kPaToHead(kPa, rho){ return (kPa * 1000) / (rho * G); } function tdh(dis_kPa, suc_kPa, rho, dz=0){ return kPaToHead(dis_kPa - suc_kPa, rho) + dz; } function npsha(sucGauge_kPa, tempC, rho){ return kPaToHead((sucGauge_kPa + ATM_kPa - Pv_kPa(tempC)), rho); } function hydPower_W(rho, q_m3h, head_m){ return rho * G * (q_m3h/3600) * head_m; } function elecPower_W(V, A, pf=0.88){ if(!V||!A) return null; return Math.sqrt(3) * V * A * pf; } async function fetchCSV(){ const res = await fetch('./data/measurements.csv'); const text = await res.text(); const lines = text.trim().split('\n'); const header = lines.shift(); const cols = header.split(','); return lines.map(line => { const vals = line.split(','); const obj = {}; cols.forEach((c,i)=> obj[c]=vals[i]); return obj; }); } function latestForEquipment(rows, equipmentId){ const filtered = rows.filter(r => r.equipmentId === equipmentId); filtered.sort((a,b)=> new Date(b.timestamp) - new Date(a.timestamp)); return filtered[0] || null; } function fmt(n, d=2){ return Number(n).toFixed(d); } function renderResult(r, equipmentId){ const tempC = Number(r.temperatureC||20); const rho = rhoWater(tempC); const TDH = tdh(Number(r.dischargeGauge_kPa||0), Number(r.suctionGauge_kPa||0), rho, Number(r.elevationDiff_m||0)); const NPSHa = npsha(Number(r.suctionGauge_kPa||0), tempC, rho); const P_hyd_kW = hydPower_W(rho, Number(r.flow_m3h||0), TDH)/1000; const P_in_kW_raw = elecPower_W(Number(r.voltage_V||0), Number(r.current_A||0)); const P_in_kW = P_in_kW_raw ? P_in_kW_raw/1000 : null; const eff = (P_in_kW && P_in_kW>0) ? (P_hyd_kW / P_in_kW * 100) : null; return ` <h2>Equipment ${equipmentId}</h2> <p><b>Timestamp</b>: ${r.timestamp}</p> <p><b>Inputs</b>: Flow ${r.flow_m3h} m³/h; Suction ${r.suctionGauge_kPa} kPa; Discharge ${r.dischargeGauge_kPa} kPa; Temp ${r.temperatureC} °C; Elevation ${r.elevationDiff_m||0} m</p> <p><b>Calculated</b>: Density ${fmt(rho,1)} kg/m³; TDH ${fmt(TDH)} m; NPSHa ${fmt(NPSHa)} m; Hydraulic Power ${P_hyd_kW?fmt(P_hyd_kW):'—'} kW; Efficiency ${eff?fmt(eff,1):'—'}% </p> <p style="font-style:italic">NPSHa uses gauge + 101.325 kPa; efficiency is indicative.</p> <p><b>Share / QR</b>: Use the URL with ?equipmentId=${encodeURIComponent(equipmentId)} and generate a QR for it.</p> `; } document.getElementById('loadBtn').addEventListener('click', async ()=>{ const equipmentId = document.getElementById('equipId').value.trim(); const out = document.getElementById('results'); if(!equipmentId){ alert('Enter Equipment ID'); return; } try { const rows = await fetchCSV(); const r = latestForEquipment(rows, equipmentId); out.style.display = 'block'; if(!r){ out.innerHTML = '<p>No data found for that Equipment ID.</p>'; return; } out.innerHTML = renderResult(r, equipmentId); } catch (e) { out.style.display = 'block'; out.innerHTML = `<p>Error loading data: ${e.message}</p>`; } }); // Auto-load if query param present const params = new URLSearchParams(location.search); const autoId = params.get('equipmentId'); if (autoId) { document.getElementById('equipId').value = autoId; document.getElementById('loadBtn').click(); } </script> </body> </html>
